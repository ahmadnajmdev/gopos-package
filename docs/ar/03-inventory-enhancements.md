# وحدة إدارة المخزون

## نظرة عامة

وحدة المخزون توفر تحكماً على مستوى المؤسسات في المخزون عبر مستودعات متعددة. تتبع المنتجات حسب أرقام الدفعة/اللوت، إدارة الأرقام التسلسلية مع الضمانات، نقل المخزون بين المواقع، وإجراء جرد المخزون الفعلي - كل ذلك مع سجلات تدقيق كاملة.

---

## لماذا تستخدم هذه الميزات؟

### الفوائد الرئيسية

| الفائدة | كيف تساعد عملك |
|---------|---------------|
| **التحكم متعدد المواقع** | تتبع المخزون عبر جميع مستودعاتك |
| **إمكانية تتبع المنتج** | اعرف بالضبط من أين جاء كل عنصر (دفعة/تسلسلي) |
| **إدارة انتهاء الصلاحية** | لا تبيع منتجات منتهية الصلاحية أبداً |
| **دقة التكلفة** | طرق تكلفة متعددة للدقة المالية |
| **منع الخسائر** | الجرد المنتظم يكتشف التناقضات مبكراً |
| **الأتمتة** | قواعد إعادة الطلب تمنع نفاد المخزون |

### المشاكل التي تحلها

- **"لا أعرف أي مستودع لديه مخزون"** - مخزون في الوقت الفعلي حسب الموقع
- **"العميل أرجع منتجاً منتهي الصلاحية"** - تتبع الدفعات مع تواريخ انتهاء الصلاحية
- **"مطالبات الضمان كابوس"** - تتبع تسلسلي مع تواريخ الضمان
- **"أعداد المخزون لا تتطابق أبداً"** - تحليل الفروقات والتعديلات
- **"نفاد العناصر الشائعة باستمرار"** - تنبيهات إعادة الطلب التلقائية
- **"نقل المخزون بين المتاجر فوضى"** - عملية نقل رسمية مع الموافقة

---

## من يجب أن يقرأ هذا؟

| الدور | الأقسام ذات الصلة |
|-------|------------------|
| **موظفو المستودع** | جميع الأقسام |
| **مديرو المخزون** | جميع الأقسام + طرق التكلفة |
| **مديرو المتاجر** | متعدد المستودعات، نقل المخزون |
| **فريق المالية** | طرق التكلفة، تقييم المخزون |
| **المطورون** | أقسام المرجع التقني |

---

## مكونات الوحدة

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          إدارة المخزون                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌────────────────────┐   تتبع المخزون عبر مواقع متعددة                │
│  │ متعدد المستودعات  │   استخدم عند: لديك أكثر من متجر                 │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   تجميع المنتجات حسب الدفعة مع تواريخ الانتهاء  │
│  │ تتبع الدفعة/اللوت │   استخدم عند: المنتجات تنتهي (طعام، دواء)       │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   تتبع الوحدات الفردية برقم تسلسلي             │
│  │  التتبع التسلسلي  │   استخدم عند: عناصر عالية القيمة أو ضمانات     │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   نقل المخزون بين المستودعات                    │
│  │   نقل المخزون     │   استخدم عند: إعادة توازن المخزون               │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   الجرد الفعلي مع تعديل الفروقات               │
│  │   جرد المخزون     │   استخدم عند: عمليات التدقيق الشهرية/السنوية    │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   FIFO, LIFO, AVCO, محدد                       │
│  │   طرق التكلفة     │   استخدم عند: متطلبات التقارير المالية         │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   تنبيهات المخزون المنخفض التلقائية            │
│  │ قواعد إعادة الطلب │   استخدم عند: منع نفاد المخزون                  │
│  └────────────────────┘                                                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## الميزة 1: إدارة المستودعات المتعددة

### ما هي؟

إدارة المستودعات المتعددة تتيح لك تتبع المخزون بشكل منفصل في كل موقع فعلي (مستودعات، متاجر، مراكز توزيع). كل موقع له مستويات مخزون خاصة به، ويمكنك رؤية إجمالي المخزون عبر جميع المواقع.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **الرؤية** | معرفة مستويات المخزون في كل موقع فوراً |
| **التخصيص** | البيع من الموقع الصحيح |
| **التخطيط** | تحديد المواقع التي تحتاج تجديد |
| **التنظيم** | مواقع الحاويات داخل المستودعات لسهولة الالتقاط |
| **المرونة** | كل مستودع يمكن أن يكون له قواعد مختلفة |

### حالة الاستخدام: سلسلة تجزئة مع مستودع مركزي

**السيناريو:** 3 متاجر تجزئة + 1 مستودع مركزي

**الإعداد:**
1. إنشاء "المستودع الرئيسي" (افتراضي، حيث تصل المشتريات)
2. إنشاء مستودعات "المتجر أ"، "المتجر ب"، "المتجر ج"
3. المشتريات تُستلم في المستودع الرئيسي
4. نقل المخزون للمتاجر حسب الحاجة
5. كل متجر يبيع من مخزونه الخاص

**الفوائد:**
- معرفة بالضبط ما في كل موقع
- نقل المخزون عند انخفاض أحد المتاجر
- المستودع الرئيسي يتعامل مع الاستلام بالجملة

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء مستودع

1. انتقل إلى **المخزون > المستودعات**
2. انقر **إنشاء مستودع**
3. أدخل التفاصيل:
   - **الاسم** (بجميع اللغات)
   - **الكود** (معرف فريد مثل "WH-001")
   - **العنوان** ومعلومات الاتصال
   - **المدير** (اختياري - تعيين الشخص المسؤول)
   - **هو الافتراضي** (أين يذهب المخزون الجديد افتراضياً)
   - **السماح بالمخزون السلبي** (تعطيل لمنع البيع الزائد)
4. انقر **إنشاء**

#### إعداد المواقع (الحاويات)

للتنظيم داخل المستودع:

1. تعديل المستودع
2. الذهاب إلى علامة **المواقع**
3. إضافة مواقع مع:
   - **الاسم** (مثل "A-01-001")
   - **الممر/الرف/الحاوية** (مثل الممر A، الرف 01، الحاوية 001)
4. استخدام هذه عند الاستلام أو الجرد

### كيفية الاستخدام (الكود)

```php
use App\Models\Warehouse;
use App\Models\WarehouseLocation;

// إنشاء مستودع
$warehouse = Warehouse::create([
    'name' => 'Main Warehouse',
    'name_ar' => 'المستودع الرئيسي',
    'name_ckb' => 'کۆگای سەرەکی',
    'code' => 'WH-001',
    'address' => 'المنطقة الصناعية 123',
    'is_default' => true,
    'allow_negative_stock' => false,
]);

// الحصول على المستودع الافتراضي
$defaultWarehouse = Warehouse::getDefault();

// إنشاء موقع داخل المستودع
$location = WarehouseLocation::create([
    'warehouse_id' => $warehouse->id,
    'name' => 'A-01-001',
    'aisle' => 'A',
    'shelf' => '01',
    'bin' => '001',
]);
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|--------|
| عيّن مستودعاً واحداً كافتراضي | اترك جميع المستودعات بدون افتراضي |
| استخدم أكواد مواقع ذات معنى | استخدم أسماء مواقع عشوائية |
| عيّن مديرين للمستودعات | اترك المستودعات بدون إدارة |
| عطّل المخزون السلبي للتجزئة | اسمح بالمخزون السلبي بدون سبب |
| تدقيق منتظم لكل موقع | تجاهل التناقضات |

---

## الميزة 2: تتبع الدفعة/اللوت

### ما هو؟

تتبع الدفعات يجمع المنتجات حسب دفعة الإنتاج أو رقم اللوت. كل دفعة لها تاريخ تصنيع وتاريخ انتهاء صلاحية وتكلفة خاصة بها. ضروري للأغذية والأدوية وأي منتجات لها تواريخ انتهاء صلاحية.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **إمكانية التتبع** | معرفة أي دفعة بيعت لأي عميل |
| **التحكم في انتهاء الصلاحية** | بيع الدفعات الأقدم أولاً (FIFO) |
| **الاستدعاءات** | تحديد المبيعات المتأثرة بسرعة إذا كانت هناك مشاكل في الدفعة |
| **تتبع التكلفة** | كل دفعة يمكن أن يكون لها تكاليف مختلفة |
| **الامتثال** | مطلوب للوائح الغذاء/الدواء |

### حالة الاستخدام: مخزون الصيدلية

**السيناريو:** الصيدلية تحتاج لتتبع دفعات الأدوية لانتهاء الصلاحية والاستدعاءات

**الإعداد:**
1. تفعيل تتبع الدفعات على جميع منتجات الأدوية
2. تعيين تحذير انتهاء الصلاحية إلى 90 يوماً
3. عند الاستلام من المورد، تسجيل رقم الدفعة وتاريخ انتهاء الصلاحية

**العمليات اليومية:**
1. النظام ينبه عند اقتراب انتهاء صلاحية الدفعات
2. الصيدلي ينقل الدفعات المنتهية للأمام
3. إذا صدر استدعاء، ابحث عن العملاء الذين اشتروا تلك الدفعة

### كيفية الاستخدام (خطوات الواجهة)

#### تفعيل تتبع الدفعات على منتج

1. تعديل المنتج
2. تفعيل **تتبع الدفعات**
3. إذا كان المنتج ينتهي:
   - تفعيل **له انتهاء صلاحية**
   - تعيين **أيام تحذير انتهاء الصلاحية** (مثل 30 يوماً)
4. حفظ

#### تسجيل الدفعات عند الاستلام

1. إنشاء طلب شراء
2. عند الاستلام، لكل عنصر يتتبع بالدفعات:
   - إدخال **رقم الدفعة**
   - إدخال **تاريخ التصنيع** (اختياري)
   - إدخال **تاريخ انتهاء الصلاحية** (إذا كان قابلاً للتطبيق)
3. إكمال الاستلام

### كيفية الاستخدام (الكود)

```php
use App\Models\ProductBatch;

// تفعيل تتبع الدفعات على المنتج
$product->update([
    'track_batches' => true,
    'has_expiry' => true,
    'expiry_warning_days' => 30,
]);

// إنشاء دفعة
$batch = ProductBatch::create([
    'product_id' => $product->id,
    'warehouse_id' => $warehouse->id,
    'batch_number' => 'BATCH-2026-001',
    'manufacture_date' => '2026-01-01',
    'expiry_date' => '2027-01-01',
    'quantity' => 100,
    'unit_cost' => 25.50,
]);

// التحقق من حالة انتهاء الصلاحية
if ($batch->isExpired()) {
    // التعامل مع الدفعة المنتهية - لا تبيع!
}

if ($batch->isExpiringSoon()) {
    // إرسال إشعار تحذير
}
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|--------|
| عيّن أيام تحذير واقعية | انتظر حتى اليوم الأخير |
| راجع الدفعات المنتهية أسبوعياً | تجاهل تقارير انتهاء الصلاحية |
| بع FIFO (الأقدم أولاً) | بع عشوائياً |
| وثّق التخلص من العناصر المنتهية | تخلص بدون سجلات |

---

## الميزة 3: تتبع الرقم التسلسلي

### ما هو؟

التتبع التسلسلي يعين معرفاً فريداً لكل وحدة فردية من المنتج. على عكس الدفعات (مجموعات من العناصر)، كل رقم تسلسلي يمثل عنصراً فعلياً واحداً بالضبط له ضمانه وحالته وتاريخه الخاص.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **التتبع الفردي** | معرفة تاريخ كل وحدة |
| **إدارة الضمان** | تتبع بداية/نهاية الضمان لكل وحدة |
| **التعامل مع المرتجعات** | التحقق من مرتجعات العملاء بالرقم التسلسلي |
| **منع السرقة** | لا يمكن تبديل العناصر بدون اكتشاف |
| **تاريخ الخدمة** | تتبع الإصلاحات والمرتجعات |

### حالة الاستخدام: متجر إلكترونيات

**السيناريو:** بيع هواتف بضمان سنة

**عند الشراء:**
1. استلام 50 هاتفاً من المورد
2. مسح كل رقم تسلسلي في النظام
3. كل هاتف مرتبط بطلب الشراء والتكلفة

**عند البيع:**
1. العميل يشتري هاتفاً
2. مسح الرقم التسلسلي
3. الرقم التسلسلي مرتبط بالعميل والبيع
4. الضمان يبدأ من تاريخ البيع

**مطالبة الضمان:**
1. العميل يحضر الهاتف بمشكلة
2. مسح الرقم التسلسلي
3. النظام يعرض: تاريخ الشراء، تاريخ البيع، نهاية الضمان
4. إذا كان تحت الضمان، معالجة المطالبة

### كيفية الاستخدام (الكود)

```php
use App\Models\ProductSerial;

// تفعيل التتبع التسلسلي على المنتج
$product->update([
    'track_serials' => true,
    'warranty_months' => 12,
]);

// إنشاء رقم تسلسلي
$serial = ProductSerial::create([
    'product_id' => $product->id,
    'warehouse_id' => $warehouse->id,
    'serial_number' => 'SN-2026-00001',
    'status' => ProductSerial::STATUS_AVAILABLE,
    'cost' => 150.00,
    'warranty_start' => now(),
    'warranty_end' => now()->addMonths(12),
]);

// التحقق من حالة الضمان
if ($serial->isUnderWarranty()) {
    echo "الضمان صالح حتى: " . $serial->warranty_end;
}
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|--------|
| امسح الأرقام التسلسلية عند الاستلام | اكتب الأرقام يدوياً |
| تحقق أن الرقم التسلسلي يطابق المنتج | افترض أن الرقم صحيح |
| درّب الموظفين على أهمية الأرقام التسلسلية | تخطى الأرقام للسرعة |
| تحقق من الرقم قبل قبول المرتجعات | اقبل المرتجعات بدون رقم تسلسلي |

---

## الميزة 4: نقل المخزون

### ما هو؟

نقل المخزون ينقل المخزون من مستودع لآخر مع عملية موافقة رسمية. النظام يتتبع ما طُلب وأُرسل واستُلم - مع توثيق الفروقات.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **عملية رسمية** | مساءلة واضحة للحركات |
| **سير عمل الموافقة** | المديرون يوافقون قبل النقل |
| **تتبع الفروقات** | معرفة إذا الكميات لا تتطابق |
| **سجل التدقيق** | من نقل ماذا، متى |
| **التخطيط** | تواريخ الوصول المتوقعة |

### سير عمل النقل

```
┌─────────┐    ┌─────────┐    ┌───────────┐    ┌──────────┐    ┌───────────┐
│  مسودة  │ →  │ معلق    │ →  │ في الطريق│ →  │  جزئي   │ →  │  مكتمل   │
└─────────┘    └─────────┘    └───────────┘    └──────────┘    └───────────┘
   إنشاء       في انتظار       العناصر         بعض العناصر     جميع العناصر
   النقل       الموافقة        شُحنت          استُلمت         استُلمت
```

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء طلب نقل

1. انتقل إلى **المخزون > نقل المخزون**
2. انقر **إنشاء نقل**
3. اختر:
   - **من المستودع** (المصدر)
   - **إلى المستودع** (الوجهة)
   - **التاريخ المتوقع** (متى يجب أن يصل)
4. أضف العناصر:
   - اختر المنتج
   - اختر الدفعة (إذا كان يُتتبع بالدفعات)
   - أدخل الكمية
5. أضف ملاحظات إذا لزم الأمر
6. احفظ كـ **مسودة** أو قدم للموافقة

#### الموافقة على النقل

1. عرض النقولات المعلقة
2. مراجعة العناصر والكميات
3. انقر **موافقة** أو **رفض**
4. إذا وُوفق، تتغير الحالة إلى **معلق** ← **في الطريق** عند الشحن

#### الاستلام

1. عند وصول العناصر إلى الوجهة
2. افتح النقل
3. لكل عنصر، أدخل **الكمية المستلمة**
4. لاحظ أي فروقات
5. انقر **إكمال**
6. المخزون ينتقل إلى المستودع الوجهة

### كيفية الاستخدام (الكود)

```php
use App\Models\StockTransfer;
use App\Services\InventoryService;

// إنشاء نقل
$transfer = StockTransfer::create([
    'from_warehouse_id' => $sourceWarehouse->id,
    'to_warehouse_id' => $destWarehouse->id,
    'transfer_date' => now(),
    'expected_date' => now()->addDays(2),
    'notes' => 'إعادة توازن المخزون الشهري',
]);

// إكمال النقل
$inventoryService = app(InventoryService::class);
$inventoryService->transferStock($transfer);
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|--------|
| تحقق من الكميات عند الاستلام | ثق بالكميات المرسلة بشكل أعمى |
| وثّق الفروقات بملاحظات | تجاهل العناصر المفقودة |
| استخدم التواريخ المتوقعة للتخطيط | اترك التواريخ فارغة |
| وافق على النقل قبل الشحن | اشحن بدون موافقة |

---

## الميزة 5: جرد المخزون

### ما هو؟

جرد المخزون (الجرد الفعلي) يقارن كميات النظام مع الكميات الفعلية الموجودة. النظام يحسب الفروقات ويسمح بتسجيل التعديلات لتصحيح المخزون.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **الدقة** | إيجاد وإصلاح التناقضات |
| **اكتشاف الخسائر** | تحديد السرقة أو الانكماش |
| **الامتثال** | مطلوب للتدقيق |
| **الدقة المالية** | قيمة المخزون تطابق الواقع |
| **رؤية تشغيلية** | فهم أين تحدث المشاكل |

### أنواع الجرد

| نوع الجرد | متى | الوصف |
|-----------|-----|-------|
| جرد كامل | سنوياً | جرد كل شيء في المستودع |
| جرد جزئي | ربع سنوي | جرد فئات محددة |
| جرد دوري | أسبوعي/شهري | اختيار دوري من العناصر |
| فحص عشوائي | حسب الحاجة | عناصر عشوائية للتحقق |

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء جرد مخزون

1. انتقل إلى **المخزون > جرد المخزون**
2. انقر **إنشاء جرد**
3. اختر:
   - **المستودع** للجرد
   - **نوع الجرد** (كامل، جزئي، دوري)
   - **تاريخ الجرد**
4. انقر **تهيئة**
5. النظام ينشئ عناصر الجرد مع كميات النظام الحالية

#### تنفيذ الجرد

1. افتح جرد المخزون
2. انقر **بدء الجرد**
3. لكل عنصر:
   - اذهب إلى الموقع
   - عد الكمية الفعلية
   - أدخل في حقل **الكمية المعدودة**
   - أضف ملاحظات لأي مشاكل
4. النظام يحسب الفرق تلقائياً

#### تسجيل التعديلات

1. عند الرضا عن دقة الجرد
2. انقر **تسجيل التعديلات**
3. النظام ينشئ حركات مخزون للفروقات
4. مستويات المخزون تُحدث لتطابق الكميات المعدودة

### كيفية الاستخدام (الكود)

```php
use App\Models\StockCount;
use App\Services\InventoryService;

$inventoryService = app(InventoryService::class);

// إنشاء جرد
$stockCount = StockCount::create([
    'warehouse_id' => $warehouse->id,
    'count_type' => 'full',
    'count_date' => now(),
    'status' => StockCount::STATUS_DRAFT,
]);

// تهيئة عناصر الجرد من المخزون الحالي
$inventoryService->initializeStockCount($stockCount);

// تسجيل التعديلات في المخزون
$inventoryService->postStockCountAdjustments($stockCount);
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|--------|
| اجرد في الأوقات الهادئة | اجرد أثناء ساعات الذروة |
| أوقف الاستلام أثناء الجرد | اقبل شحنات أثناء الجرد |
| عد العناصر عالية القيمة مرتين | ثق بالعد الواحد |
| حقق في جميع الفروقات | تجاهل الفروقات الصغيرة |
| وثّق أسباب الفرق | سجل التعديلات بدون تفسير |

---

## الميزة 6: طرق التكلفة

### ما هي؟

طرق التكلفة تحدد كيف تُحسب تكاليف المخزون عند بيع العناصر أو تعديلها. الطرق المختلفة تنتج تكلفة بضاعة مباعة (COGS) وقيم مخزون مختلفة.

### الطرق المتاحة

| الطريقة | الاسم الكامل | الأفضل لـ |
|---------|-------------|----------|
| **FIFO** | الأول في الأول خارج | المواد القابلة للتلف، معظم الأعمال |
| **LIFO** | الأخير في الأول خارج | التحسين الضريبي (حيث مسموح) |
| **AVCO** | متوسط التكلفة المرجح | الأعمال البسيطة، التكاليف المتقلبة |
| **محدد** | التحديد المحدد | العناصر الفريدة/عالية القيمة |

### فهم كل طريقة

#### FIFO (الأول في الأول خارج)

**ما يفعله:** تكاليف المخزون الأقدم تُستخدم أولاً عند البيع.

**متى تستخدم:**
- البضائع القابلة للتلف (تطابق التدفق الفعلي)
- الأسعار المرتفعة (تكلفة بضاعة مباعة أقل، ربح أعلى)
- الأكثر شيوعاً والأكثر قبولاً

#### AVCO (متوسط التكلفة المرجح)

**ما يفعله:** متوسط التكلفة عبر كل المخزون.

**متى تستخدم:**
- التكاليف تتقلب بشكل متكرر
- الأعمال البسيطة
- العناصر قابلة للتبادل

### كيفية الاستخدام

1. تعديل المنتج
2. اختر **طريقة التكلفة**:
   - FIFO (افتراضي)
   - LIFO
   - AVCO
   - محدد (يتطلب تتبع تسلسلي)
3. حفظ

---

## الميزة 7: قواعد إعادة الطلب

### ما هي؟

قواعد إعادة الطلب تنبهك تلقائياً عندما ينخفض المخزون تحت حد معين، واختيارياً تحسب كم تطلب. تمنع نفاد العناصر الشائعة.

### المفاهيم الرئيسية

| المصطلح | التعريف |
|---------|---------|
| **نقطة إعادة الطلب** | مستوى المخزون الذي يُطلق التنبيه |
| **كمية إعادة الطلب** | كم تطلب |
| **الحد الأدنى** | لا تنزل أقل من هذا |
| **الحد الأقصى** | لا تطلب أكثر من هذا |
| **وقت التسليم** | أيام للتوصيل |

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء قاعدة إعادة طلب

1. انتقل إلى **المخزون > قواعد إعادة الطلب** أو تعديل المنتج
2. انقر **إنشاء قاعدة**
3. عيّن:
   - **المنتج** و**المستودع**
   - **الحد الأدنى** (مخزون الأمان)
   - **الحد الأقصى** (حد التخزين)
   - **نقطة إعادة الطلب** (متى تنبه)
   - **كمية إعادة الطلب** (كم تطلب)
   - **أيام وقت التسليم** (وقت التوصيل)
   - **المورد المفضل** (اختياري)
4. حفظ

### كيفية الاستخدام (الكود)

```php
use App\Models\ReorderRule;

// إنشاء قاعدة إعادة طلب
$rule = ReorderRule::create([
    'product_id' => $product->id,
    'warehouse_id' => $warehouse->id,
    'supplier_id' => $preferredSupplier->id,
    'minimum_quantity' => 10,
    'maximum_quantity' => 100,
    'reorder_point' => 25,
    'reorder_quantity' => 50,
    'lead_time_days' => 7,
    'is_active' => true,
]);

// التحقق إذا يحتاج إعادة طلب
if ($rule->needsReorder()) {
    $suggestedQty = $rule->getSuggestedOrderQuantity();
}
```

---

## حل المشاكل

### المخزون يظهر سلبياً رغم عدم السماح

**المشكلة:** المنتج يظهر مخزوناً سلبياً مع تعطيل "السماح بالسلبي".

**الحلول:**
1. تحقق من الطلبات المعلقة التي حجزت مخزوناً
2. راجع حركات المخزون للأخطاء
3. أجرِ جرد مخزون للمطابقة

---

### الدفعة لا تظهر في البيع

**المشكلة:** لا أستطيع اختيار الدفعة عند البيع.

**الحلول:**
1. تحقق أن الدفعة لديها كمية متاحة
2. تحقق أن الدفعة غير منتهية الصلاحية
3. تأكد أن الدفعة في المستودع الصحيح
4. تحقق أن المنتج مفعل عليه تتبع الدفعات

---

### كميات النقل لا تتطابق

**المشكلة:** استُلم أقل مما أُرسل.

**الحلول:**
1. وثّق الفرق بملاحظات
2. أكمل النقل بالكميات الفعلية المستلمة
3. حقق في المستودع المصدر
4. النظام ينشئ تعديلاً تلقائياً

---

### تنبيه إعادة الطلب لا يظهر

**المشكلة:** المخزون منخفض لكن لا يوجد تنبيه.

**الحلول:**
1. تحقق أن قاعدة إعادة الطلب نشطة
2. تحقق أن نقطة إعادة الطلب مضبوطة بشكل صحيح
3. تأكد أن المستودع يطابق إعدادات القاعدة
4. تحقق من الكمية المحجوزة مقابل الكمية الإجمالية

---

*آخر تحديث: يناير 2026*
