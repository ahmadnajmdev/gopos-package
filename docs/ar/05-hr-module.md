# وحدة الموارد البشرية (HR)

## نظرة عامة

توفر وحدة الموارد البشرية إدارة شاملة لدورة حياة الموظف - من التوظيف إلى كشوف المرتبات. إدارة الهيكل التنظيمي، تتبع الحضور، معالجة طلبات الإجازة، وإنشاء كشوف المرتبات مع حسابات تلقائية. مصمم لسوق العراق/كردستان مع دعم ثلاثي اللغات (الإنجليزية، العربية، الكردية السورانية).

---

## لماذا استخدام هذه الميزات؟

### الفوائد الرئيسية

| الفائدة | كيف تساعد عملك |
|---------|----------------|
| **بيانات مركزية للموظفين** | جميع معلومات الموظفين في مكان واحد |
| **حضور آلي** | تتبع الساعات، التأخير، المغادرة المبكرة |
| **إدارة الإجازات** | طلب، موافقة، تتبع أرصدة الإجازات |
| **معالجة كشوف المرتبات** | حساب الرواتب، الخصومات، إنشاء كشوف الراتب |
| **الامتثال** | تتبع العقود، المستندات، المتطلبات القانونية |
| **الخدمة الذاتية** | يمكن للموظفين عرض معلوماتهم الخاصة |

### المشاكل التي يحلها

- **"سجلات الموظفين متناثرة في كل مكان"** - قاعدة بيانات مركزية للموظفين
- **"نتتبع الحضور يدوياً على الورق"** - تتبع الحضور الرقمي
- **"حسابات رصيد الإجازات محيرة"** - تتبع الرصيد التلقائي
- **"كشوف المرتبات تستغرق أياماً للمعالجة"** - حسابات كشوف المرتبات الآلية
- **"ننسى المستندات المنتهية الصلاحية"** - تنبيهات انتهاء المستندات
- **"الموظفون يسألون HR باستمرار عن كشوف الراتب"** - وصول الخدمة الذاتية

---

## من يجب أن يقرأ هذا؟

| الدور | الأقسام ذات الصلة |
|-------|-------------------|
| **مديرو الموارد البشرية** | جميع الأقسام |
| **موظفو الموارد البشرية** | الموظفين، الحضور، الإجازات |
| **مسؤولو كشوف المرتبات** | كشوف المرتبات، قروض الموظفين |
| **مديرو الأقسام** | الحضور، الموافقة على الإجازات |
| **الموظفون** | ميزات الخدمة الذاتية |

---

## مكونات الوحدة

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          وحدة الموارد البشرية                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌────────────────────┐   الأقسام، المناصب، هيكل التقارير               │
│  │   الهيكل التنظيمي  │   استخدم عند: إعداد هيكل الشركة                 │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   ملفات الموظفين، العقود، المستندات             │
│  │     الموظفين       │   استخدم عند: إدارة معلومات الموظفين             │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   تسجيل الحضور/الانصراف، ساعات العمل، الجداول    │
│  │     الحضور         │   استخدم عند: تتبع ساعات العمل اليومية           │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   طلبات الإجازة، الموافقات، الأرصدة             │
│  │   إدارة الإجازات   │   استخدم عند: معالجة طلبات الإجازة               │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   حساب الراتب، كشوف الراتب، المكونات            │
│  │   كشوف المرتبات    │   استخدم عند: معالجة الرواتب الشهرية             │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   قروض الموظفين وتتبع السداد                    │
│  │   قروض الموظفين    │   استخدم عند: إدارة السلف/القروض                │
│  └────────────────────┘                                                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## الميزة 1: الهيكل التنظيمي

### ما هو؟

يحدد الهيكل التنظيمي التسلسل الهرمي لشركتك - الأقسام، المناصب، وعلاقات التقارير. هذا يشكل الأساس لجميع عمليات الموارد البشرية.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **تسلسل هرمي واضح** | من يقدم تقاريره لمن |
| **تتبع الأقسام** | تجميع الموظفين حسب القسم |
| **إدارة المناصب** | تحديد المسميات والدرجات الوظيفية |
| **مواءمة الميزانية** | الربط بمراكز التكلفة للمحاسبة |
| **قابلية التوسع** | ينمو مع مؤسستك |

### متى تستخدم

| السيناريو | الإجراء |
|-----------|---------|
| إعداد HR لأول مرة | إنشاء الأقسام والمناصب |
| إنشاء قسم جديد | إضافة القسم إلى الهيكل |
| مسمى وظيفي جديد مطلوب | إنشاء منصب |
| إعادة الهيكلة | تحديث علاقات التقارير |
| توظيف موظفين | تعيين إلى القسم والمنصب |

### حالة استخدام: إعداد هيكل الشركة

**السيناريو:** شركة تجزئة بـ 3 متاجر

**الهيكل:**
```
الشركة
├── الإدارة
│   ├── قسم الموارد البشرية
│   └── قسم المالية
├── العمليات
│   ├── المتجر أ
│   ├── المتجر ب
│   └── المتجر ج
└── المستودع
```

**المناصب:**
- مدير متجر
- أمين صندوق
- موظف مستودع
- مسؤول موارد بشرية
- محاسب

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء الأقسام

1. انتقل إلى **الموارد البشرية > الأقسام**
2. انقر على **إنشاء قسم**
3. أدخل:
   - **الاسم** (بجميع اللغات)
   - **الرمز** (مثل HR-001)
   - **القسم الأب** (للتسلسل الهرمي)
   - **المدير** (رئيس القسم)
   - **مركز التكلفة** (للمحاسبة)
4. انقر على **إنشاء**

#### إنشاء المناصب

1. انتقل إلى **الموارد البشرية > المناصب**
2. انقر على **إنشاء منصب**
3. أدخل:
   - **المسمى** (بجميع اللغات)
   - **الرمز** (مثل POS-CASHIER)
   - **القسم** (أين ينتمي المنصب)
   - **الدرجة/المستوى** (لنطاقات الرواتب)
   - **الوصف** (مسؤوليات الوظيفة)
4. انقر على **إنشاء**

### كيفية الاستخدام (الكود)

```php
use App\Models\Department;
use App\Models\Position;

// إنشاء قسم
$salesDept = Department::create([
    'name' => 'Sales Department',
    'name_ar' => 'قسم المبيعات',
    'name_ckb' => 'بەشی فرۆشتن',
    'code' => 'DEPT-SALES',
    'parent_id' => $operationsDept->id,
    'manager_id' => $manager->id,
    'cost_center_id' => $costCenter->id,
    'is_active' => true,
]);

// إنشاء منصب
$position = Position::create([
    'title' => 'Sales Representative',
    'title_ar' => 'مندوب مبيعات',
    'title_ckb' => 'نوێنەری فرۆشتن',
    'code' => 'POS-SALES-REP',
    'department_id' => $salesDept->id,
    'grade' => 'B',
    'min_salary' => 500000,
    'max_salary' => 800000,
    'description' => 'مسؤول عن مبيعات العملاء...',
    'is_active' => true,
]);

// الحصول على التسلسل الهرمي للأقسام
$departments = Department::with('children', 'employees')->get();

// الحصول على المناصب في قسم
$positions = Position::where('department_id', $salesDept->id)->get();
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|---------|
| أعد الهيكل قبل إضافة الموظفين | أضف الموظفين بدون هيكل |
| عيّن مديرين للأقسام | اترك الأقسام بدون رؤساء |
| استخدم تسمية رموز متسقة | استخدم رموز عشوائية |
| اربط بمراكز التكلفة | تجاهل تكامل المحاسبة |

---

## الميزة 2: إدارة الموظفين

### ما هي؟

تخزن إدارة الموظفين جميع المعلومات عن موظفيك - التفاصيل الشخصية، معلومات التوظيف، العقود، المؤهلات، والمستندات. إنها قاعدة البيانات المركزية للموظفين.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **سجلات كاملة** | كل شيء عن موظف في مكان واحد |
| **تتبع العقود** | عقود التوظيف مع التواريخ |
| **تخزين المستندات** | الهوية، الشهادات، الرخص |
| **جهات الاتصال الطارئة** | وصول سريع لجهات الاتصال |
| **السجل** | تتبع تغييرات المنصب والراتب |

### متى تستخدم

| السيناريو | الإجراء |
|-----------|---------|
| توظيف موظف جديد | إنشاء سجل الموظف |
| ترقية موظف | تحديث المنصب والراتب |
| تجديد العقد | تحديث تواريخ العقد |
| انتهاء مستند | رفع مستند جديد |
| مغادرة موظف | وضع علامة غير نشط، تسجيل تاريخ الانتهاء |

### حالة استخدام: تأهيل موظف جديد

**السيناريو:** توظيف أحمد كمندوب مبيعات جديد

**الخطوات:**
1. إنشاء سجل الموظف بالمعلومات الشخصية
2. تحديد تفاصيل التوظيف (تاريخ البدء، القسم، المنصب)
3. تحديد الراتب ومعلومات الدفع
4. رفع المستندات (الهوية، الصورة، الشهادات)
5. إنشاء حساب مستخدم للوصول إلى النظام
6. تعيين جدول العمل
7. تهيئة أرصدة الإجازات

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء موظف

1. انتقل إلى **الموارد البشرية > الموظفين**
2. انقر على **إنشاء موظف**
3. **المعلومات الشخصية:**
   - الاسم (بجميع اللغات)، تاريخ الميلاد، الجنس
   - رقم الهوية، الهاتف، البريد الإلكتروني
   - العنوان، جهة الاتصال الطارئة
4. **تفاصيل التوظيف:**
   - رمز الموظف (تلقائي أو يدوي)
   - القسم والمنصب
   - نوع التوظيف (دوام كامل، جزئي، عقد)
   - تاريخ البدء، تاريخ انتهاء العقد
   - المدير (من يقدم له التقارير)
5. **التعويض:**
   - الراتب الأساسي
   - طريقة الدفع (نقداً، تحويل بنكي)
   - الحساب البنكي (إذا كان قابلاً للتطبيق)
6. **المستندات:**
   - رفع نسخة الهوية، الصورة، الشهادات
   - تحديد تواريخ انتهاء المستندات
7. انقر على **إنشاء**

### كيفية الاستخدام (الكود)

```php
use App\Models\Employee;
use App\Models\EmployeeDocument;
use App\Services\HR\EmployeeService;

$employeeService = app(EmployeeService::class);

// إنشاء موظف
$employee = $employeeService->createEmployee([
    // المعلومات الشخصية
    'first_name' => 'Ahmed',
    'first_name_ar' => 'أحمد',
    'last_name' => 'Hassan',
    'last_name_ar' => 'حسن',
    'date_of_birth' => '1990-05-15',
    'gender' => 'male',
    'national_id' => '12345678901234',
    'phone' => '+964 750 123 4567',
    'email' => 'ahmed@company.com',

    // التوظيف
    'employee_code' => 'EMP-001',
    'department_id' => $salesDept->id,
    'position_id' => $salesRep->id,
    'employment_type' => 'full_time',
    'hire_date' => '2026-01-15',
    'basic_salary' => 600000,
]);

// أنواع التوظيف
Employee::TYPE_FULL_TIME;   // دوام كامل دائم
Employee::TYPE_PART_TIME;   // دوام جزئي
Employee::TYPE_CONTRACT;    // عقد محدد المدة
Employee::TYPE_TEMPORARY;   // عامل مؤقت
Employee::TYPE_INTERN;      // متدرب

// حالات التوظيف
Employee::STATUS_ACTIVE;      // موظف حالياً
Employee::STATUS_ON_LEAVE;    // في إجازة ممتدة
Employee::STATUS_SUSPENDED;   // موقوف مؤقتاً
Employee::STATUS_TERMINATED;  // انتهى التوظيف
Employee::STATUS_RESIGNED;    // استقال الموظف

// إضافة مستند
EmployeeDocument::create([
    'employee_id' => $employee->id,
    'type' => 'national_id',
    'name' => 'بطاقة الهوية الوطنية',
    'file_path' => 'documents/emp-001/national-id.pdf',
    'expiry_date' => '2030-01-01',
]);

// الحصول على الموظفين بمستندات تنتهي قريباً
$expiringDocs = $employeeService->getExpiringContracts(days: 30);
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|---------|
| أكمل جميع الحقول المطلوبة | اترك السجلات ناقصة |
| ارفع نسخ المستندات | احتفظ بالسجلات الورقية فقط |
| حدد تواريخ انتهاء المستندات | انسَ تجديد المستندات |
| حدّث السجلات فوراً | اترك السجلات تصبح قديمة |

---

## الميزة 3: تتبع الحضور

### ما هو؟

يسجل تتبع الحضور متى يبدأ الموظفون وينتهون من العمل كل يوم. يحسب تلقائياً ساعات العمل، العمل الإضافي، التأخير، والمغادرة المبكرة بناءً على جداول العمل.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **سجلات دقيقة** | اعرف بالضبط متى يعمل الموظفون |
| **حسابات تلقائية** | النظام يحسب الساعات، التأخير، العمل الإضافي |
| **تكامل جدول العمل** | المقارنة مع الجدول المتوقع |
| **اتصال كشوف المرتبات** | الحضور يغذي كشوف المرتبات |
| **طرق متعددة** | إدخال يدوي، تسجيل الحضور/الانصراف، استيراد |

### متى تستخدم

| السيناريو | الإجراء |
|-----------|---------|
| وصول الموظف للعمل | تسجيل الحضور |
| مغادرة الموظف للعمل | تسجيل الانصراف |
| مراجعة الحضور الشهري | إنشاء تقرير الحضور |
| معالجة كشوف المرتبات | استخدام بيانات الحضور |

### حالة استخدام: تسجيل الحضور اليومي

**السيناريو:** تتبع الحضور اليومي لموظفي المتجر

**جدول العمل:** 9:00 صباحاً - 5:00 مساءً (8 ساعات)

**حضور أحمد:**
- تسجيل الحضور: 9:15 صباحاً (متأخر 15 دقيقة)
- تسجيل الانصراف: 6:00 مساءً (ساعة إضافية واحدة)
- ساعات العمل: 8:45
- الساعات العادية: 8
- العمل الإضافي: 0:45

### كيفية الاستخدام (خطوات الواجهة)

#### إعداد جداول العمل

1. انتقل إلى **الموارد البشرية > جداول العمل**
2. انقر على **إنشاء جدول**
3. أدخل:
   - **الاسم** (مثل "ساعات العمل الرسمية")
   - **أيام العمل** (الأحد-الخميس للعراق)
   - **وقت البدء** و **وقت الانتهاء**
   - **مدة الاستراحة** (استراحة الغداء)
   - **فترة السماح** (الدقائق قبل اعتباره متأخراً)
4. انقر على **إنشاء**

#### تسجيل الحضور

**الإدخال اليدوي:**
1. انتقل إلى **الموارد البشرية > الحضور**
2. انقر على **إضافة حضور**
3. اختر الموظف والتاريخ
4. أدخل أوقات الحضور والانصراف
5. احفظ

**الخدمة الذاتية للموظف:**
1. الموظف ينقر على **تسجيل الحضور** عند الوصول
2. النظام يسجل الوقت الحالي
3. الموظف ينقر على **تسجيل الانصراف** عند المغادرة

### كيفية الاستخدام (الكود)

```php
use App\Models\Attendance;
use App\Models\WorkSchedule;
use App\Services\HR\AttendanceService;

$attendanceService = app(AttendanceService::class);

// إنشاء جدول عمل
$schedule = WorkSchedule::create([
    'name' => 'Standard Office Hours',
    'name_ar' => 'ساعات العمل الرسمية',
    'name_ckb' => 'کاتژمێری کاری فەرمی',
    'work_days' => ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday'],
    'start_time' => '09:00',
    'end_time' => '17:00',
    'break_duration' => 60,
    'late_tolerance' => 15,
    'is_active' => true,
]);

// تسجيل الحضور
$attendance = $attendanceService->clockIn($employee, 'المكتب', '192.168.1.1');

// تسجيل الانصراف
$attendanceService->clockOut($employee, 'المكتب', '192.168.1.1');

// حالات الحضور
Attendance::STATUS_PRESENT;  // حضور عادي
Attendance::STATUS_ABSENT;   // لم يحضر
Attendance::STATUS_LATE;     // وصل متأخراً
Attendance::STATUS_LEAVE;    // في إجازة معتمدة
Attendance::STATUS_HOLIDAY;  // عطلة رسمية

// الحصول على تقرير الحضور
$report = $attendanceService->getEmployeeSummary($employee, 2026, 1);
// يعود: days_present, days_absent, total_hours, overtime_hours, late_count
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|---------|
| أعد الجداول قبل التتبع | تتبع بدون جداول |
| سجّل الحضور يومياً | أدخل بشكل مجمع في نهاية الشهر |
| تحقق من أيام الغياب | تجاهل الغياب غير المبرر |
| راجع قبل كشوف المرتبات | عالج كشوف المرتبات بشكل أعمى |

---

## الميزة 4: إدارة الإجازات

### ما هي؟

تتعامل إدارة الإجازات مع طلبات إجازة الموظفين - من التقديم إلى الموافقة إلى تتبع الرصيد. تدعم أنواع إجازات متعددة مع سياسات قابلة للتكوين.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **طلبات الخدمة الذاتية** | الموظفون يقدمون طلباتهم بأنفسهم |
| **سير عمل الموافقة** | موافقة المدير مع إشعارات |
| **تتبع الرصيد** | حسابات الرصيد التلقائية |
| **إنفاذ السياسات** | إنفاذ قواعد الإجازة تلقائياً |
| **عرض التقويم** | انظر من في إجازة ومتى |

### أنواع الإجازات

| النوع | الوصف | السياسة النموذجية |
|-------|-------|-------------------|
| **سنوية** | إجازة/عطلة | 21-30 يوم/سنة |
| **مرضية** | إجازة طبية | حسب الحاجة مع مستندات |
| **بدون راتب** | إجازة بدون أجر | حسب الموافقة |
| **أمومة** | إجازة الولادة | 70 يوم (القانون العراقي) |
| **طوارئ** | حالات عاجلة | 3-5 أيام |

### متى تستخدم

| السيناريو | الإجراء |
|-----------|---------|
| الموظف يحتاج إجازة | تقديم طلب إجازة |
| المدير يراجع الطلب | الموافقة أو الرفض |
| بداية سنة جديدة | تهيئة الأرصدة |
| التحقق من التغطية | عرض تقويم الإجازات |

### حالة استخدام: طلب إجازة سنوية

**السيناريو:** أحمد يطلب 5 أيام إجازة

**العملية:**
1. أحمد يقدم طلب إجازة (20-24 يناير)
2. النظام يتحقق من الرصيد (لديه 21 يوم)
3. المدير يستلم إشعار
4. المدير يوافق
5. رصيد أحمد: 21 → 16 يوم متبقي

### كيفية الاستخدام (الكود)

```php
use App\Models\LeaveType;
use App\Models\LeaveRequest;
use App\Services\HR\LeaveService;

$leaveService = app(LeaveService::class);

// إنشاء نوع إجازة
$annualLeave = LeaveType::create([
    'name' => 'Annual Leave',
    'name_ar' => 'إجازة سنوية',
    'name_ckb' => 'مۆڵەتی ساڵانە',
    'code' => 'ANNUAL',
    'default_days' => 21,
    'is_paid' => true,
    'can_carry_forward' => true,
    'max_carry_forward' => 5,
]);

// تقديم طلب إجازة
$request = $leaveService->submitRequest(
    employee: $employee,
    leaveTypeId: $annualLeave->id,
    startDate: Carbon::parse('2026-02-15'),
    endDate: Carbon::parse('2026-02-19'),
    reason: 'إجازة عائلية'
);

// الموافقة على الطلب
$leaveService->approveRequest($request, $manager->id);

// رفض الطلب
$leaveService->rejectRequest($request, $manager->id, 'تغطية غير كافية');

// الحصول على ملخص إجازة الموظف
$summary = $leaveService->getEmployeeSummary($employee, 2026);
// يعود: entitled, used, pending, available لكل نوع إجازة
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|---------|
| هيئ الأرصدة سنوياً | انسَ إعداد الأرصدة |
| اطلب مستندات للإجازة المرضية | اقبل بدون إثبات |
| راجع الطلبات المعلقة يومياً | اترك الطلبات تتراكم |

---

## الميزة 5: معالجة كشوف المرتبات

### ما هي؟

تحسب معالجة كشوف المرتبات رواتب الموظفين بناءً على الحضور، الإجازات، البدلات، الخصومات، وسداد القروض. تنشئ كشوف الراتب وتسجل اختيارياً في المحاسبة.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **حسابات آلية** | لا حسابات رواتب يدوية |
| **مبني على المكونات** | بدلات وخصومات مرنة |
| **تكامل الحضور** | يسحب بيانات الحضور تلقائياً |
| **خصومات القروض** | سداد القروض التلقائي |
| **إنشاء كشوف الراتب** | كشوف راتب احترافية |

### متى تستخدم

| السيناريو | الإجراء |
|-----------|---------|
| نهاية الشهر | إنشاء فترة كشوف المرتبات |
| مراجعة كشوف المرتبات | إنشاء كشوف الراتب |
| كل شيء تم التحقق منه | الموافقة على كشوف المرتبات |
| دفع للموظفين | وضع علامة كمدفوعة |

### حالة استخدام: كشوف المرتبات الشهرية

**السيناريو:** معالجة كشوف مرتبات يناير 2026

**العملية:**
1. إنشاء فترة كشوف المرتبات (1-31 يناير 2026)
2. النظام يحسب لكل موظف:
   - الراتب الأساسي
   - تعديلات الحضور
   - البدلات
   - الخصومات والقروض
   - صافي الراتب
3. مراجعة كشوف الراتب
4. الموافقة على كشوف المرتبات
5. إنشاء ملف البنك للدفع

### كيفية الاستخدام (الكود)

```php
use App\Models\PayrollPeriod;
use App\Models\PayrollComponent;
use App\Services\HR\PayrollService;

$payrollService = app(PayrollService::class);

// إنشاء مكون كشوف المرتبات
$transport = PayrollComponent::create([
    'name' => 'Transport Allowance',
    'name_ar' => 'بدل النقل',
    'name_ckb' => 'کرێی گواستنەوە',
    'code' => 'TRANSPORT',
    'type' => 'earning', // earning أو deduction
    'calculation_type' => 'fixed',
    'amount' => 50000,
    'is_taxable' => true,
]);

// إنشاء فترة كشوف المرتبات
$period = $payrollService->createPeriod(2026, 1);

// معالجة كشوف المرتبات لجميع الموظفين
$payrollService->processPayroll($period);

// الموافقة على كشوف المرتبات
$payrollService->approvePayroll($period, $approver->id);

// وضع علامة كمدفوعة
$payrollService->markAsPaid($period, $payer->id);

// إنشاء ملف البنك للتحويلات
$bankFile = $payrollService->generateBankFile($period, 'csv');
```

### أفضل الممارسات

| افعل | لا تفعل |
|------|---------|
| أعد المكونات أولاً | أضف مكونات في منتصف الفترة |
| راجع كل كشف راتب | وافق بدون فحص |
| شغّل كشوف المرتبات شهرياً | تأخير معالجة كشوف المرتبات |

---

## الميزة 6: قروض الموظفين

### ما هي؟

تتبع قروض الموظفين السلف والقروض المعطاة للموظفين، مع خصومات سداد تلقائية من رواتبهم.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **تتبع القروض** | تاريخ القروض الكامل |
| **خصومات تلقائية** | خصومات شهرية من الراتب |
| **رؤية الرصيد** | تتبع الرصيد المتبقي |

### حالة استخدام: سلفة راتب

**السيناريو:** أحمد يطلب سلفة 500,000 دينار على 5 أشهر

1. إنشاء قرض: 500,000 دينار، 5 أقساط
2. كل فترة رواتب: خصم 100,000 دينار
3. بعد 5 أشهر: اكتمل القرض

### كيفية الاستخدام (الكود)

```php
use App\Models\EmployeeLoan;
use App\Models\LoanRepayment;

// إنشاء قرض موظف
$loan = EmployeeLoan::create([
    'employee_id' => $employee->id,
    'loan_type' => 'salary_advance',
    'amount' => 500000,
    'installments' => 5,
    'monthly_installment' => 100000,
    'start_date' => '2026-02-01',
    'status' => 'active',
    'approved_by' => $manager->id,
]);

// التحقق من الرصيد المتبقي
$remaining = $loan->remaining_balance;
```

---

## المرجع التقني

### الخدمات

| الخدمة | الغرض |
|--------|-------|
| `AttendanceService` | تسجيل الحضور/الانصراف، تقارير الحضور |
| `LeaveService` | طلبات الإجازة، الأرصدة، الموافقات |
| `PayrollService` | معالجة كشوف المرتبات، كشوف الراتب |
| `EmployeeService` | CRUD الموظفين، النقل، الإنهاء |

### جداول قاعدة البيانات

| الجدول | الغرض |
|--------|-------|
| departments | الهيكل التنظيمي |
| positions | المناصب الوظيفية |
| employees | سجلات الموظفين |
| work_schedules | تعريفات ساعات العمل |
| attendances | سجلات الحضور اليومي |
| holidays | تقويم العطل الرسمية |
| leave_types | تعريفات أنواع الإجازات |
| leave_balances | أرصدة إجازات الموظفين |
| leave_requests | سير عمل طلب الإجازة |
| payroll_components | مكونات الراتب |
| payroll_periods | دورات كشوف المرتبات الشهرية |
| payslips | كشوف راتب الموظفين |
| employee_loans | تتبع القروض |

---

## استكشاف الأخطاء وإصلاحها

### الحضور لا يحسب بشكل صحيح

**الحلول:**
1. تحقق من تعيين جدول العمل
2. تحقق من صحة أوقات الجدول
3. تحقق من تسجيل أوقات الحضور

---

### رصيد الإجازة خاطئ

**الحلول:**
1. تحقق من تحديد الرصيد الأولي
2. تحقق من خصم الإجازات المعتمدة
3. تحقق من الترحيل من السنة السابقة

---

### خصم كشوف المرتبات مفقود

**الحلول:**
1. تحقق من تعيين المكون للموظف
2. تحقق من أن المكون نشط
3. أعد إنشاء كشف الراتب بعد التغييرات

---

*آخر تحديث: يناير 2026*
