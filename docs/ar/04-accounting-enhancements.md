# تحسينات وحدة المحاسبة

## نظرة عامة

وحدة المحاسبة توفر إمكانيات إدارة مالية على مستوى المؤسسات. بالإضافة إلى مسك الدفاتر الأساسي، تتضمن مطابقة البنك، الموازنات مع تحليل الفروقات، تتبع مراكز التكلفة، وتقارير التدفق النقدي التلقائية.

---

## لماذا تستخدم هذه الميزات؟

### الفوائد الرئيسية

| الفائدة | كيف تساعد عملك |
|---------|---------------|
| **التحكم البنكي** | مطابقة الحسابات شهرياً، اكتشاف الأخطاء مبكراً |
| **إدارة الموازنة** | تخطيط الإنفاق، تتبع الفروقات، ضبط التكاليف |
| **رؤية التكلفة** | معرفة تكلفة كل قسم/مشروع |
| **رؤية التدفق النقدي** | فهم أين يذهب النقد |
| **جاهزية التدقيق** | سجلات كاملة للمدققين والسلطات الضريبية |

### المشاكل التي تحلها

- **"كشف البنك لا يطابق دفاترنا"** - عملية مطابقة شهرية
- **"ننفق زيادة بدون أن ندري"** - تنبيهات فروقات الموازنة
- **"أي قسم يكلف أكثر؟"** - تتبع مراكز التكلفة
- **"هل سيكون لدينا نقد الشهر القادم؟"** - قوائم التدفق النقدي
- **"محاسبنا يستخدم جداول البيانات لكل شيء"** - حل متكامل

---

## من يجب أن يقرأ هذا؟

| الدور | الأقسام ذات الصلة |
|-------|------------------|
| **المحاسبون** | جميع الأقسام |
| **مديرو المالية** | جميع الأقسام، خاصة الموازنات |
| **مديرو الأقسام** | مراكز التكلفة، الموازنة مقابل الفعلي |
| **أصحاب الأعمال** | التدفق النقدي، نظرة عامة على الموازنة |
| **المدققون** | المطابقة، سجل التدقيق |

---

## مكونات الوحدة

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        تحسينات المحاسبة                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌────────────────────┐   تتبع حسابات البنك والمعاملات                  │
│  │  إدارة البنوك      │   استخدم عند: إدارة حسابات الشركة البنكية       │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   مطابقة كشوف البنك مع سجلات الدفاتر            │
│  │  مطابقة البنك      │   استخدم عند: الإغلاق الشهري، التحضير للتدقيق   │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   تخطيط وتتبع الإنفاق                           │
│  │  نظام الموازنات    │   استخدم عند: التخطيط السنوي، ضبط التكاليف      │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   تتبع التكاليف حسب القسم/المشروع               │
│  │  مراكز التكلفة     │   استخدم عند: مساءلة الأقسام                    │
│  └────────────────────┘                                                 │
│                                                                         │
│  ┌────────────────────┐   تحليل التدفقات النقدية الداخلة والخارجة        │
│  │  تقرير التدفق النقدي│   استخدم عند: تخطيط النقد، تقارير المستثمرين   │
│  └────────────────────┘                                                 │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## الميزة 1: إدارة الحسابات البنكية

### ما هي؟

إدارة الحسابات البنكية تتتبع جميع حسابات الشركة البنكية داخل GoPOS. سجل الإيداعات والسحوبات والتحويلات والرسوم - كلها مرتبطة بحسابات دفتر الأستاذ.

### الفوائد الرئيسية

| الفائدة | الوصف |
|---------|-------|
| **رؤية مركزية** | جميع الحسابات البنكية في مكان واحد |
| **رصيد في الوقت الفعلي** | معرفة الأرصدة الحالية دائماً |
| **تاريخ المعاملات** | سجل كامل لجميع الحركات |
| **تكامل دفتر الأستاذ** | ربط تلقائي بخريطة الحسابات |
| **متعدد العملات** | دعم الدينار والدولار وعملات أخرى |

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء حساب بنكي

1. انتقل إلى **المحاسبة > الحسابات البنكية**
2. انقر **إنشاء حساب بنكي**
3. أدخل التفاصيل:
   - **حساب دفتر الأستاذ** (الربط بحساب نقد/بنك موجود)
   - **اسم البنك** (بجميع اللغات)
   - **رقم الحساب**
   - **IBAN** (إذا كان قابلاً للتطبيق)
   - **العملة**
   - **الرصيد الافتتاحي**
4. انقر **إنشاء**

#### تسجيل المعاملات

1. افتح الحساب البنكي
2. انقر **إضافة معاملة**
3. اختر نوع المعاملة:
   - **إيداع** - أموال داخلة
   - **سحب** - أموال خارجة
   - **تحويل** - بين الحسابات
   - **رسوم** - رسوم البنك
   - **فائدة** - الفائدة المكتسبة
4. أدخل المبلغ والتاريخ والمرجع والوصف
5. احفظ

### كيفية الاستخدام (الكود)

```php
use App\Models\BankAccount;
use App\Models\BankTransaction;

// إنشاء حساب بنكي
$bankAccount = BankAccount::create([
    'account_id' => $glAccount->id,
    'bank_name' => 'Central Bank of Iraq',
    'bank_name_ar' => 'البنك المركزي العراقي',
    'account_number' => '1234567890',
    'currency_id' => $currency->id,
    'opening_balance' => 50000.00,
]);

// تسجيل إيداع
$transaction = $bankAccount->recordTransaction([
    'type' => BankTransaction::TYPE_DEPOSIT,
    'description' => 'دفعة عميل مستلمة',
    'amount' => 5000.00,
    'transaction_date' => now(),
]);
```

---

## الميزة 2: مطابقة البنك

### ما هي؟

مطابقة البنك تطابق سجلات دفاترك مع كشوف البنك الفعلية. تحدد الشيكات المعلقة والإيداعات في الطريق ورسوم البنك والأخطاء.

### صيغة المطابقة

```
رصيد الدفتر                           55,000
- رسوم البنك (غير مسجلة بعد)           (500)
= رصيد الدفتر المعدل                  54,500

رصيد الكشف                           52,500
- الشيكات المعلقة                    (3,000)
+ الإيداعات في الطريق                  5,000
= رصيد البنك المعدل                  54,500

الفرق: 0 (متطابق!)
```

### كيفية الاستخدام (خطوات الواجهة)

#### بدء المطابقة

1. انتقل إلى **المحاسبة > مطابقة البنك**
2. انقر **مطابقة جديدة**
3. اختر **الحساب البنكي**
4. أدخل:
   - **تاريخ الكشف**
   - **رصيد الكشف** (من كشف البنك)
   - **بداية/نهاية الفترة**
5. انقر **إنشاء**

#### إكمال المطابقة

1. اعرض **الملخص** الذي يظهر:
   - رصيد الدفتر مقابل رصيد الدفتر المعدل
   - رصيد الكشف مقابل رصيد الكشف المعدل
   - الفرق (يجب أن يكون 0)
2. إذا كان متوازناً، انقر **إكمال المطابقة**
3. النظام ينشئ قيود يومية للتعديلات

---

## الميزة 3: نظام الموازنات

### ما هو؟

نظام الموازنات يتيح لك إنشاء موازنات سنوية، تتبع الإنفاق مقابل الموازنة، تحديد الفروقات، وإجراء تعديلات.

### أنواع الموازنات

| النوع | الغرض | متى تستخدم |
|-------|-------|-----------|
| **تشغيلية** | المصاريف اليومية | تخطيط المصاريف السنوي |
| **رأسمالية** | شراء الأصول | المعدات، المركبات، المباني |
| **التدفق النقدي** | توقعات النقد | تخطيط النقد |
| **مشروع** | مشاريع محددة | الإنفاق القائم على المشاريع |

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء موازنة

1. انتقل إلى **المحاسبة > الموازنات**
2. انقر **إنشاء موازنة**
3. أدخل:
   - **الاسم** (بجميع اللغات)
   - **الفترة المالية** (السنة)
   - **نوع الموازنة** (تشغيلية، رأسمالية، إلخ.)
4. انقر **إنشاء**

#### إضافة بنود الموازنة

1. افتح الموازنة
2. انقر **إضافة بند**
3. اختر:
   - **حساب دفتر الأستاذ** (حساب المصاريف)
   - **مركز التكلفة** (اختياري)
4. أدخل المبالغ لكل شهر
5. احفظ

#### عرض الموازنة مقابل الفعلي

1. اذهب إلى **التقارير > الموازنة مقابل الفعلي**
2. اختر الموازنة والفترة
3. اعرض:
   - المبلغ المُوازَن لكل حساب
   - الإنفاق الفعلي
   - الفرق (المبلغ والنسبة)
   - مؤشرات الزيادة/النقص عن الموازنة

---

## الميزة 4: محاسبة مراكز التكلفة

### ما هي؟

مراكز التكلفة تتتبع الإيرادات والمصاريف حسب القسم أو المشروع أو الموقع أو أي وحدة تنظيمية.

### أنواع مراكز التكلفة

| النوع | الغرض | مثال |
|-------|-------|------|
| **قسم** | وحدة تنظيمية | المبيعات، الموارد البشرية، تكنولوجيا المعلومات |
| **مشروع** | مشاريع محددة | تنفيذ نظام ERP |
| **موقع** | جغرافي | مكتب أربيل، مكتب بغداد |
| **خط المنتج** | مجموعات المنتجات | الإلكترونيات، الأثاث |

### كيفية الاستخدام (خطوات الواجهة)

#### إنشاء مركز تكلفة

1. انتقل إلى **المحاسبة > مراكز التكلفة**
2. انقر **إنشاء مركز تكلفة**
3. أدخل:
   - **الكود** (مثل CC-SALES)
   - **الاسم** (بجميع اللغات)
   - **النوع** (قسم، مشروع، إلخ.)
   - **المدير** (اختياري)
   - **الأصل** (للتسلسل الهرمي)
4. انقر **إنشاء**

#### تخصيص التكاليف

عند إنشاء المعاملات:
1. في القيود اليومية، اختر مركز التكلفة لكل بند
2. في المصاريف، اختر مركز التكلفة
3. في بنود الموازنة، اختر مركز التكلفة

---

## الميزة 5: قائمة التدفق النقدي

### ما هي؟

قائمة التدفق النقدي تظهر من أين جاء النقد وأين ذهب خلال فترة. منظمة إلى أنشطة تشغيلية واستثمارية وتمويلية.

### أقسام التدفق النقدي

| القسم | ما يظهره | أمثلة |
|-------|----------|-------|
| **التشغيل** | النقد من العمليات التجارية | المبيعات، المصاريف، رأس المال العامل |
| **الاستثمار** | النقد للأصول طويلة الأمد | شراء المعدات، بيع الأصول |
| **التمويل** | النقد من التمويل | القروض، مساهمات المالك |

### كيفية الاستخدام

1. انتقل إلى **التقارير > المالية > قائمة التدفق النقدي**
2. اختر نطاق التاريخ
3. انقر **إنشاء**
4. اعرض التقرير مع:
   - الأنشطة التشغيلية
   - الأنشطة الاستثمارية
   - الأنشطة التمويلية
   - الملخص
5. تصدير إلى PDF أو Excel

---

## حل المشاكل

### مطابقة البنك لا تتوازن

**المشكلة:** بعد إضافة جميع البنود، الفرق ليس صفراً.

**الحلول:**
1. تحقق من إدخال رصيد الكشف بشكل صحيح
2. ابحث عن معاملات مفقودة (إيداعات/سحوبات)
3. ابحث عن رسوم بنك غير مسجلة
4. تحقق من فروقات التوقيت (حدود الشهر)
5. راجع قائمة الشيكات المعلقة

---

### فرق الموازنة يظهر بشكل غير صحيح

**المشكلة:** أرقام الموازنة مقابل الفعلي لا تطابق التوقعات.

**الحلول:**
1. تحقق أن المعاملات لها تواريخ ترحيل صحيحة
2. تحقق من تخصيصات مراكز التكلفة
3. تأكد أن حسابات دفتر الأستاذ تطابق بنود الموازنة
4. راجع ترحيلات القيود اليومية

---

### التدفق النقدي لا يطابق تغير رصيد البنك

**المشكلة:** رصيد إغلاق قائمة التدفق النقدي لا يطابق البنك.

**الحلول:**
1. تحقق أن جميع حسابات النقد مضمنة
2. تحقق أن المعاملات غير النقدية معدلة
3. راجع تصنيفات حسابات دفتر الأستاذ
4. تحقق من القيود غير المرحلة

---

*آخر تحديث: يناير 2026*
